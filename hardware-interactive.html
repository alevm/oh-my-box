<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oh My Box - Interactive Hardware</title>
    <style>
        :root {
            --bg: #f5f0e8;
            --accent: #e94560;
            --pastel-blue: #d6eaf8;
            --pastel-gray: #e8e8e8;
            --pastel-violet: #e8daef;
            --blue-text: #1a5276;
            --gray-text: #2c3e50;
            --violet-text: #4a235a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .top-bar {
            background: linear-gradient(180deg, #3d2817 0%, #2a1a0f 100%);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            border-bottom: 2px solid #8b5a2b;
        }

        .logo { font-size: 18px; font-weight: 800; color: #d4a574; letter-spacing: 2px; }

        .nav-links { display: flex; gap: 8px; margin-left: auto; }

        .nav-link {
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            color: #d4a574;
            text-decoration: none;
            font-size: 13px;
        }
        .nav-link:hover { background: rgba(255,255,255,0.2); }
        .nav-link.active { background: var(--accent); color: #fff; }

        /* Main */
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: linear-gradient(180deg, #2a1a0f 0%, #1a100a 100%);
        }

        /* Device - 200x140mm scaled (~3.5x) */
        .device-container { position: relative; width: 720px; height: 520px; }

        .enclosure {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 700px;
            height: 490px;
            background: linear-gradient(165deg, #2a2a2a 0%, #1a1a1a 40%, #0f0f0f 100%);
            border-radius: 14px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 0 2px #3a3a3a, inset 0 1px 0 rgba(255,255,255,0.08);
        }

        .enclosure::before {
            content: '';
            position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border: 1px solid rgba(139, 90, 43, 0.2);
            border-radius: 10px;
            pointer-events: none;
        }

        /* Artwork */
        .artwork {
            position: absolute;
            top: 200px; left: 10px; right: 10px; bottom: 10px;
            opacity: 0.06;
            background-image: url('https://media.rhizome.org/blog/8979/Chombart-de-Lauwe.jpg');
            background-size: cover;
            filter: invert(1) brightness(1.5);
            border-radius: 8px;
            z-index: 0;
            pointer-events: none;
        }

        /* Panel backgrounds */
        .panel-bg { position: absolute; border-radius: 6px; z-index: 1; }
        .panel-pads { top: 210px; left: 15px; width: 340px; height: 180px; background: var(--pastel-gray); border: 1px solid #c0c0c0; }
        .panel-ctrl { top: 210px; right: 15px; width: 180px; height: 180px; background: var(--pastel-gray); border: 1px solid #c0c0c0; }
        .panel-transport { bottom: 15px; left: 15px; width: 150px; height: 45px; background: var(--pastel-gray); border: 1px solid #c0c0c0; }
        .panel-scenes { bottom: 15px; right: 15px; width: 160px; height: 45px; background: var(--pastel-gray); border: 1px solid #c0c0c0; }

        /* 5" Display (800x480 scaled) */
        .display {
            position: absolute;
            top: 10px; left: 10px; right: 10px;
            height: 190px;
            background: #0a0a0a;
            border-radius: 6px;
            border: 2px solid #333;
            overflow: hidden;
            z-index: 2;
        }

        .display-content {
            width: 100%;
            height: 100%;
            background: #111;
            padding: 6px;
            display: grid;
            grid-template-columns: 1fr 100px 90px;
            gap: 6px;
        }

        /* Sequencer in display */
        .seq-panel {
            background: #0d0d0d;
            border-radius: 4px;
            padding: 5px;
            display: flex;
            flex-direction: column;
        }

        .seq-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .seq-title { color: #27ae60; font-size: 10px; font-weight: 700; }
        .seq-info { display: flex; gap: 10px; }
        .seq-info span { color: #666; font-size: 9px; }
        .seq-info .val { color: #27ae60; }

        .seq-grid {
            display: grid;
            grid-template-columns: 24px repeat(16, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 1px;
            flex: 1;
        }

        .track-label { display: flex; align-items: center; justify-content: center; color: #555; font-size: 7px; font-weight: 600; }
        .step { background: #1a1a1a; border-radius: 1px; cursor: pointer; }
        .step:hover { background: #252525; }
        .step.on { background: #27ae60; }
        .step.playing { box-shadow: inset 0 0 0 1px #fff; }

        /* Touch Mixer in display */
        .mixer-panel {
            background: #0d0d0d;
            border-radius: 4px;
            padding: 5px;
            display: flex;
            flex-direction: column;
        }

        .mixer-title { color: var(--blue-text); font-size: 9px; font-weight: 700; margin-bottom: 4px; background: var(--pastel-blue); padding: 2px 4px; border-radius: 2px; text-align: center; }

        .mixer-faders {
            display: flex;
            justify-content: space-around;
            flex: 1;
            padding-top: 4px;
        }

        .touch-fader {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .fader-track {
            width: 10px;
            height: 100px;
            background: linear-gradient(180deg, #27ae60 0%, #1a5276 50%, #0d0d0d 100%);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }

        .fader-level {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #27ae60;
            border-radius: 3px;
            transition: height 0.1s;
        }

        .fader-label { font-size: 7px; color: #888; }

        /* Status panel in display */
        .status-panel {
            background: #0d0d0d;
            border-radius: 4px;
            padding: 5px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .status-item { text-align: center; padding: 3px; background: #080808; border-radius: 2px; }
        .status-label { font-size: 7px; color: #555; }
        .status-value { font-size: 12px; color: #27ae60; font-weight: 700; font-family: monospace; }
        .status-value.rec { color: #e94560; }

        /* Pattern/Scene buttons in display */
        .btn-row { display: flex; gap: 3px; margin-top: 4px; }
        .display-btn {
            flex: 1;
            height: 18px;
            background: #222;
            border: 1px solid #333;
            border-radius: 2px;
            color: #666;
            font-size: 8px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .display-btn:hover { background: #2a2a2a; }
        .display-btn.active { background: #27ae60; color: #fff; border-color: #27ae60; }

        /* Section labels */
        .section-label {
            position: absolute;
            font-size: 8px;
            font-weight: 700;
            letter-spacing: 1px;
            z-index: 3;
        }
        .label-pads { top: 215px; left: 25px; color: var(--gray-text); }
        .label-ctrl { top: 215px; right: 25px; color: var(--gray-text); width: 160px; text-align: center; }

        /* 8 Touch Pads */
        .pads-container {
            position: absolute;
            top: 235px; left: 25px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 8px;
            width: 320px;
            height: 140px;
            z-index: 2;
        }

        .pad {
            background: linear-gradient(145deg, #4a4a4a 0%, #2a2a2a 100%);
            border-radius: 8px;
            border: 2px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        .pad:hover { background: linear-gradient(145deg, #5a5a5a 0%, #3a3a3a 100%); }
        .pad:active, .pad.active {
            background: linear-gradient(145deg, #27ae60 0%, #1e8449 100%);
            border-color: #27ae60;
            color: #fff;
        }

        .pad::before {
            content: '';
            position: absolute;
            top: 4px; right: 4px;
            width: 6px; height: 6px;
            border-radius: 50%;
            background: #333;
        }
        .pad.active::before { background: #fff; box-shadow: 0 0 6px #fff; }

        /* 4 Encoders */
        .encoders-container {
            position: absolute;
            top: 235px; right: 25px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            width: 160px;
            height: 150px;
            z-index: 2;
        }

        .encoder { display: flex; flex-direction: column; align-items: center; gap: 3px; }

        .encoder-knob {
            width: 44px; height: 44px;
            background: linear-gradient(145deg, #666 0%, #444 100%);
            border-radius: 50%;
            border: 2px solid #333;
            position: relative;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
        }

        .encoder-knob::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 18px; height: 18px;
            background: linear-gradient(145deg, #555 0%, #333 100%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .encoder-knob::after {
            content: '';
            position: absolute;
            top: 5px; left: 50%;
            width: 3px; height: 10px;
            background: var(--accent);
            border-radius: 2px;
            transform: translateX(-50%);
        }

        .encoder-label { font-size: 9px; color: var(--gray-text); font-weight: 600; }
        .encoder-value { font-size: 8px; color: #666; font-family: monospace; }

        /* 4 RGB LEDs */
        .leds-container {
            position: absolute;
            top: 400px; right: 35px;
            display: flex;
            gap: 12px;
            z-index: 2;
        }

        .led {
            width: 10px; height: 10px;
            border-radius: 50%;
            background: #222;
            border: 1px solid #444;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
        }
        .led.on-green { background: #27ae60; box-shadow: 0 0 8px #27ae60; }
        .led.on-red { background: #e94560; box-shadow: 0 0 8px #e94560; }
        .led.on-blue { background: #3498db; box-shadow: 0 0 8px #3498db; }

        /* Transport */
        .transport-container {
            position: absolute;
            bottom: 22px; left: 25px;
            display: flex;
            gap: 10px;
            z-index: 2;
        }

        .transport-btn {
            width: 38px; height: 38px;
            background: linear-gradient(145deg, #4a4a4a 0%, #2a2a2a 100%);
            border-radius: 50%;
            border: 2px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 14px;
            cursor: pointer;
        }

        .transport-btn:hover { background: linear-gradient(145deg, #5a5a5a 0%, #3a3a3a 100%); }
        .transport-btn.play.active { background: #27ae60; color: #fff; border-color: #27ae60; }
        .transport-btn.rec.active { background: #e94560; color: #fff; border-color: #e94560; }

        /* Scenes */
        .scenes-container {
            position: absolute;
            bottom: 22px; right: 25px;
            display: flex;
            gap: 6px;
            align-items: center;
            z-index: 2;
        }

        .scenes-label { font-size: 8px; color: var(--gray-text); font-weight: 700; margin-right: 4px; }

        .scene-btn {
            width: 30px; height: 30px;
            background: #d5d8dc;
            border: 2px solid #aeb6bf;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-text);
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
        }
        .scene-btn:hover { background: #bdc3c7; }
        .scene-btn.active { background: #27ae60; border-color: #27ae60; color: #fff; }

        /* I/O */
        .io-ports {
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .io-port {
            width: 16px; height: 16px;
            background: #0a0a0a;
            border-radius: 50%;
            border: 2px solid #444;
        }

        /* Info bar */
        .info-bar {
            background: #1a1a1a;
            padding: 8px 16px;
            display: flex;
            justify-content: center;
            gap: 24px;
            color: #888;
            font-size: 11px;
        }
        .info-bar span { color: #27ae60; font-weight: 600; }
    </style>
</head>
<body>
    <header class="top-bar">
        <div class="logo">OH MY BOX</div>
        <nav class="nav-links">
            <a href="index.html" class="nav-link">Web App</a>
            <a href="hardware-mockup.html" class="nav-link">Design</a>
            <a href="hardware-interactive.html" class="nav-link active">Interactive</a>
            <a href="requirements.html" class="nav-link">Requirements</a>
        </nav>
    </header>

    <main class="main-content">
        <div class="device-container">
            <div class="enclosure">
                <div class="artwork"></div>

                <!-- Panel backgrounds -->
                <div class="panel-bg panel-pads"></div>
                <div class="panel-bg panel-ctrl"></div>
                <div class="panel-bg panel-transport"></div>
                <div class="panel-bg panel-scenes"></div>

                <!-- 5" Touch Display -->
                <div class="display">
                    <div class="display-content">
                        <!-- Sequencer -->
                        <div class="seq-panel">
                            <div class="seq-header">
                                <span class="seq-title">SEQUENCER</span>
                                <div class="seq-info">
                                    <span>PTN:<span class="val" id="ptnDisplay">A</span></span>
                                    <span>BPM:<span class="val" id="bpmVal">120</span></span>
                                </div>
                            </div>
                            <div class="seq-grid" id="seqGrid"></div>
                            <div class="btn-row" id="patternBtns">
                                <div class="display-btn active" data-ptn="0">A</div>
                                <div class="display-btn" data-ptn="1">B</div>
                                <div class="display-btn" data-ptn="2">C</div>
                                <div class="display-btn" data-ptn="3">D</div>
                                <div class="display-btn" data-ptn="4">E</div>
                                <div class="display-btn" data-ptn="5">F</div>
                                <div class="display-btn" data-ptn="6">G</div>
                                <div class="display-btn" data-ptn="7">H</div>
                            </div>
                        </div>

                        <!-- Touch Mixer -->
                        <div class="mixer-panel">
                            <div class="mixer-title">MIXER</div>
                            <div class="mixer-faders">
                                <div class="touch-fader" data-ch="mic">
                                    <div class="fader-track"><div class="fader-level" style="height:70%"></div></div>
                                    <span class="fader-label">MIC</span>
                                </div>
                                <div class="touch-fader" data-ch="smp">
                                    <div class="fader-track"><div class="fader-level" style="height:80%"></div></div>
                                    <span class="fader-label">SMP</span>
                                </div>
                                <div class="touch-fader" data-ch="syn">
                                    <div class="fader-track"><div class="fader-level" style="height:75%"></div></div>
                                    <span class="fader-label">SYN</span>
                                </div>
                                <div class="touch-fader" data-ch="rad">
                                    <div class="fader-track"><div class="fader-level" style="height:60%"></div></div>
                                    <span class="fader-label">RAD</span>
                                </div>
                                <div class="touch-fader" data-ch="out">
                                    <div class="fader-track"><div class="fader-level" style="height:85%"></div></div>
                                    <span class="fader-label">OUT</span>
                                </div>
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="status-panel">
                            <div class="status-item">
                                <div class="status-label">TIME</div>
                                <div class="status-value" id="timeDisplay">00:00</div>
                            </div>
                            <div class="status-item">
                                <div class="status-label">STATUS</div>
                                <div class="status-value" id="statusDisplay">STOP</div>
                            </div>
                            <div class="status-item">
                                <div class="status-label">GPS</div>
                                <div class="status-value" style="font-size:8px;">40.71°N</div>
                            </div>
                            <div class="btn-row">
                                <div class="display-btn active" data-scene="0">A</div>
                                <div class="display-btn" data-scene="1">B</div>
                                <div class="display-btn" data-scene="2">C</div>
                                <div class="display-btn" data-scene="3">D</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Labels -->
                <span class="section-label label-pads">PADS</span>
                <span class="section-label label-ctrl">CTRL</span>

                <!-- 8 Touch Pads -->
                <div class="pads-container" id="padsContainer">
                    <div class="pad" data-pad="0">1</div>
                    <div class="pad" data-pad="1">2</div>
                    <div class="pad" data-pad="2">3</div>
                    <div class="pad" data-pad="3">4</div>
                    <div class="pad" data-pad="4">5</div>
                    <div class="pad" data-pad="5">6</div>
                    <div class="pad" data-pad="6">7</div>
                    <div class="pad" data-pad="7">8</div>
                </div>

                <!-- 4 Encoders -->
                <div class="encoders-container">
                    <div class="encoder" data-param="volume">
                        <div class="encoder-knob" data-value="80"></div>
                        <span class="encoder-label">VOL</span>
                        <span class="encoder-value">80</span>
                    </div>
                    <div class="encoder" data-param="pan">
                        <div class="encoder-knob" data-value="50"></div>
                        <span class="encoder-label">PAN</span>
                        <span class="encoder-value">C</span>
                    </div>
                    <div class="encoder" data-param="filter">
                        <div class="encoder-knob" data-value="100"></div>
                        <span class="encoder-label">FILT</span>
                        <span class="encoder-value">100</span>
                    </div>
                    <div class="encoder" data-param="fx">
                        <div class="encoder-knob" data-value="0"></div>
                        <span class="encoder-label">FX</span>
                        <span class="encoder-value">0</span>
                    </div>
                </div>

                <!-- 4 RGB LEDs -->
                <div class="leds-container">
                    <div class="led on-green" id="led1"></div>
                    <div class="led" id="led2"></div>
                    <div class="led" id="led3"></div>
                    <div class="led" id="led4"></div>
                </div>

                <!-- Transport (3 buttons) -->
                <div class="transport-container">
                    <div class="transport-btn play" data-action="play">&#9654;</div>
                    <div class="transport-btn stop" data-action="stop">&#9632;</div>
                    <div class="transport-btn rec" data-action="rec">&#9679;</div>
                </div>

                <!-- Scene buttons -->
                <div class="scenes-container">
                    <span class="scenes-label">SCENE</span>
                    <div class="scene-btn active" data-scene="0">A</div>
                    <div class="scene-btn" data-scene="1">B</div>
                    <div class="scene-btn" data-scene="2">C</div>
                    <div class="scene-btn" data-scene="3">D</div>
                </div>
            </div>

            <!-- I/O Ports -->
            <div class="io-ports">
                <div class="io-port" title="Audio Out"></div>
                <div class="io-port" title="Headphones"></div>
                <div class="io-port" title="Mic In"></div>
            </div>
        </div>
    </main>

    <div class="info-bar">
        <div>Enclosure: <span>200×140×45mm</span></div>
        <div>Display: <span>5" Touch</span></div>
        <div>Pads: <span>8× MPR121</span></div>
        <div>Encoders: <span>4× Rotary</span></div>
        <div>Cost: <span>~$280</span></div>
    </div>

    <script>
        let audioCtx = null;
        let isPlaying = false;
        let isRecording = false;
        let currentStep = 0;
        let currentPattern = 0;
        let bpm = 120;
        let stepInterval = null;

        const patterns = Array(8).fill(null).map(() => Array(8).fill(null).map(() => Array(16).fill(false)));
        const tracks = ['BD', 'SD', 'HH', 'PC', 'S1', 'S2', 'S3', 'S4'];

        function initSeqGrid() {
            const grid = document.getElementById('seqGrid');
            grid.innerHTML = '';
            tracks.forEach((track, ti) => {
                const label = document.createElement('div');
                label.className = 'track-label';
                label.textContent = track;
                grid.appendChild(label);
                for (let s = 0; s < 16; s++) {
                    const step = document.createElement('div');
                    step.className = 'step' + (patterns[currentPattern][ti][s] ? ' on' : '');
                    step.dataset.track = ti;
                    step.dataset.step = s;
                    step.onclick = () => { patterns[currentPattern][ti][s] = !patterns[currentPattern][ti][s]; step.classList.toggle('on'); };
                    grid.appendChild(step);
                }
            });
        }

        function playStep() {
            document.querySelectorAll('.step').forEach(el => el.classList.remove('playing'));
            document.querySelectorAll(`.step[data-step="${currentStep}"]`).forEach(el => el.classList.add('playing'));
            tracks.forEach((_, ti) => { if (patterns[currentPattern][ti][currentStep]) playSound(ti); });
            currentStep = (currentStep + 1) % 16;

            // LED animation
            document.querySelectorAll('.led').forEach((l,i) => l.className = 'led' + (i === currentStep % 4 ? ' on-green' : ''));
        }

        function playSound(ti) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const freqs = [60, 200, 800, 400, 300, 350, 250, 450];
            osc.type = ['sine', 'triangle', 'square', 'sawtooth'][ti % 4];
            osc.frequency.setValueAtTime(freqs[ti], audioCtx.currentTime);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }

        function startPlay() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            isPlaying = true;
            currentStep = 0;
            document.querySelector('.transport-btn.play').classList.add('active');
            document.getElementById('statusDisplay').textContent = 'PLAY';
            stepInterval = setInterval(playStep, (60 / bpm) * 1000 / 4);
        }

        function stopPlay() {
            isPlaying = false;
            clearInterval(stepInterval);
            document.querySelector('.transport-btn.play').classList.remove('active');
            document.getElementById('statusDisplay').textContent = 'STOP';
            document.querySelectorAll('.step').forEach(el => el.classList.remove('playing'));
            document.querySelectorAll('.led').forEach((l,i) => l.className = 'led' + (i === 0 ? ' on-green' : ''));
        }

        // Pads
        document.querySelectorAll('.pad').forEach(pad => {
            const trigger = () => {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                pad.classList.add('active');
                playSound(parseInt(pad.dataset.pad));
                if (isRecording && isPlaying) {
                    patterns[currentPattern][parseInt(pad.dataset.pad)][currentStep] = true;
                    document.querySelector(`.step[data-track="${pad.dataset.pad}"][data-step="${currentStep}"]`)?.classList.add('on');
                }
            };
            pad.onmousedown = trigger;
            pad.onmouseup = () => pad.classList.remove('active');
            pad.onmouseleave = () => pad.classList.remove('active');
        });

        // Keyboard 1-8
        document.onkeydown = e => {
            const k = parseInt(e.key);
            if (k >= 1 && k <= 8) {
                const pad = document.querySelector(`.pad[data-pad="${k-1}"]`);
                if (pad && !pad.classList.contains('active')) { pad.classList.add('active'); if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); playSound(k-1); }
            }
            if (e.code === 'Space') { e.preventDefault(); isPlaying ? stopPlay() : startPlay(); }
        };
        document.onkeyup = e => { const k = parseInt(e.key); if (k >= 1 && k <= 8) document.querySelector(`.pad[data-pad="${k-1}"]`)?.classList.remove('active'); };

        // Transport
        document.querySelector('.transport-btn.play').onclick = () => isPlaying ? stopPlay() : startPlay();
        document.querySelector('.transport-btn.stop').onclick = stopPlay;
        document.querySelector('.transport-btn.rec').onclick = () => {
            isRecording = !isRecording;
            document.querySelector('.transport-btn.rec').classList.toggle('active', isRecording);
            document.getElementById('statusDisplay').textContent = isRecording ? 'REC' : (isPlaying ? 'PLAY' : 'STOP');
            document.getElementById('statusDisplay').classList.toggle('rec', isRecording);
        };

        // Pattern buttons
        document.querySelectorAll('[data-ptn]').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('[data-ptn]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPattern = parseInt(btn.dataset.ptn);
                document.getElementById('ptnDisplay').textContent = btn.textContent;
                initSeqGrid();
            };
        });

        // Scene buttons (both display and physical)
        document.querySelectorAll('[data-scene]').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('[data-scene]').forEach(b => b.classList.remove('active'));
                document.querySelectorAll(`[data-scene="${btn.dataset.scene}"]`).forEach(b => b.classList.add('active'));
            };
        });

        // Touch mixer faders
        document.querySelectorAll('.fader-track').forEach(track => {
            track.onclick = e => {
                const rect = track.getBoundingClientRect();
                const pct = Math.max(0, Math.min(100, ((rect.bottom - e.clientY) / rect.height) * 100));
                track.querySelector('.fader-level').style.height = pct + '%';
            };
        });

        // Encoders
        document.querySelectorAll('.encoder-knob').forEach(knob => {
            let startY, startVal;
            knob.onmousedown = e => {
                startY = e.clientY;
                startVal = parseInt(knob.dataset.value) || 50;
                const move = e => {
                    const v = Math.max(0, Math.min(100, startVal + (startY - e.clientY)));
                    knob.dataset.value = v;
                    const enc = knob.closest('.encoder');
                    const valEl = enc.querySelector('.encoder-value');
                    valEl.textContent = enc.dataset.param === 'pan' ? (v < 45 ? 'L' : v > 55 ? 'R' : 'C') : Math.round(v);
                };
                const up = () => { document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); };
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', up);
            };
        });

        // Time
        setInterval(() => {
            const now = new Date();
            document.getElementById('timeDisplay').textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
        }, 1000);

        // Init with default pattern
        patterns[0][0][0] = patterns[0][0][4] = patterns[0][0][8] = patterns[0][0][12] = true;
        patterns[0][1][4] = patterns[0][1][12] = true;
        patterns[0][2][0] = patterns[0][2][2] = patterns[0][2][4] = patterns[0][2][6] = patterns[0][2][8] = patterns[0][2][10] = patterns[0][2][12] = patterns[0][2][14] = true;
        initSeqGrid();
    </script>
</body>
</html>
